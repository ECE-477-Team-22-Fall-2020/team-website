<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
This is an example weekly progress report document that team members can use to report their individual progress 
of their ECE477 senior design projects. Weekly progress reports are expected to follow the general guidelines
presented in the "Progress Report Policy" document, available online at https://engineering.purdue.edu/ece477/Course/Policies/policies.html

Please create 4 copies of this example, renaming each copy to <PurdueID>.html, where <PurdueID> corresponds to
the Purdue ITAP Career Account ID given by Purdue to each individual team member. If you have any questions,
contact course staff.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!--Reconfigurable base tag; used to modify the site root location for root-relative links-->
<base href="https://engineering.purdue.edu/477grp22/" />

<!--Content-->
<title>ECE477 Course Documents</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="author" content="George Hadley">
<meta name = "format-detection" content = "telephone=no" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!--CSS-->
<link rel="stylesheet" href="css/default.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/responsive.css">
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/content.css">
<!--[if IE 6]>
<link href="default_ie6.css" rel="stylesheet" type="text/css" />
<![endif]-->

</head>
<body>
<div id="wrapper_site">
    <div id="wrapper_page">
	<!-- Instantiate global site header.-->
	<div id="header"></div>
		<!-- Instantiate site global navigation bar.-->
		<div id="menu"></div>
	
		<!-- Instantiate a page banner image. Page banner images should be 1100x350px and should be located within the local
			img folder located at this directory level. -->
		<div id="banner">
			<img src="Files/img/BannerImgExample.jpg"></img>
		</div>
	
		<!-- Instantiate "tools" needed for a page. Tools are premade functional blocks that can be used to build a page,
			and include things such as a file lister (for listing out homework assignments or tutorials)
		-->
		<div id="content">
            <h2>Progress Report for Ian Haggerty</h2>
            
            <h4>Week 1:</h4>
            <b>Date:</b> 3 September 2020<br>
            <b>Total hours:</b> 2<br>
			<b>Description of design efforts:</b><br>
			Met with the team to determine the updated requirements for the project necessary for Homework 1. This included making the decision to drop magnetic movement of pieces, as well as made the decision to go with Hall Effect sensors to sense piece placements.
			Initialize the team github organization, allowing future work to be closely monitored by version control.

            <br>

            <h4>Week 2:</h4>
            <b>Date:</b> 4 September 2020<br>
            <b>Total hours:</b> 4<br>
			<b>Description of design efforts:</b><br>
			Met with the team to determine how to respond to communicate project requirements changes to core course staff.
			Worked on generating better PSSCs, including a third hardware PSSC.
			Initialized the website GitHub repository, then ensured that the repository was initialized in the shared network folder.
			Wrote the "Functional Description" and "Thermal/Power Constraints" sections of the Functional Specification document.
			
			<br>

            <h4>Week 3:</h4>
            <b>Date:</b> 11 September 2020<br>
            <b>Total hours:</b> 4<br>
			<b>Description of design efforts:</b><br>
			Wrote the "Screen" section of the component analysis, ultimately contributing to the decision to display moves on the screen rather than with LEDs underneath the board. This decision was made after advice from the teaching team on the Wednesday meeting.
			<br>The choice of screens was between a square LCD screen and a rectangular OLED screen. A picture of the OLED display is shown below. The OLED screen was chosen since it is better for conveying information other than a rendering of the board state;
			the board is right in front of the screen, so having a nice rendering of it didn't seem very helpful. Graphics like the one found in the example image will be used to make the UI look more complete, and a more in depth analysis of this can be found in the component analysis. A table comparing the two components is also presented in this report.

			<br><br>

			<b>An example graphic on the OLED display</b>
			
			<p><img src="Team/progress/img/oled_example_graphic.jpg" width="400" height="auto"></img></p>

			<b>A chart comparing two display options</b>

			<p><img src="Team/progress/img/oled_chart.JPG" width="400" height="auto"></img></p>

			<br>

			Reduced the overlap between PSSCs, making it more clear which actual hardware model was related to each requirements. This included clearly delineating between the bluetooth communication with the bluetooth and phone, and the internet communication between each phone.

			<br><br>

			Helped arrive at the decision to use the STM32F4 microcontroller family, and picked up one to be used for the initial hardware demo coming up.

			<br>
			
            <h4>Week 4:</h4>
            <b>Date:</b> 18 September 2020<br>
            <b>Total hours:</b> 5<br>
			<b>Description of design efforts:</b><br>
			Assisted teammate Matthew MacLean in setting up this week's progress report demo by finding documents such as the family reference manual, helping to configure his "System Workbench for STM32" environment after some initial struggles (mine was already set up from last year, but he had switched his OS), and providing saved documents from ECE362 on fixing problems with the firmware.
			A link to the video is included below:

			<br>

			<video width="320" controls>
				<source src="Media/img/SMAT_1.mp4" type="video/mp4">
				Your browser does not support the video tag.
			</video>

			<br><br>

			Personally ordered around $180 worth of project materials. These orders were set to be delivered Friday, but this was delayed until Monday. Anticipating a delay, similar parts were looked for in the ECE parts shop. Unfortunately, the staff there were relatively unhelpful during two separate visits from Matt and I.
			The staff didn't know what Hall Effect sensors were, and were unable to find any chips in the shop which could detect a magnetic field. The staff on the second visit knew what a multiplexer was, but only knew where to find the digital ones. Part numbers were provided to them, but their catalog system seems to be in a transitionary state right now, so their searches were unsuccessful.
			One takeaway from this process was that the parts shop should really only be used for even more basic parts, like resistors and capacitors, as well as possibly some of the converters used in the voltage regulation subsystem.

			<br><br>

			The team had planned to meet on Thursday or Friday to conduct experiments using magnets, hall effect sensors, and an analog multiplexer. The goal of the testing was to see if the resistance induced by the analog multiplexer would be an issue when getting the hall effect sensor outputs. This experiment is delayed until next week, due to the delays mentioned above.
			The team has an idea of how to test these chips. The multiplexer will be bound to choose one of its lines, with the hall effect sensor on that line. A weak permanent magnet will be put in front of the hall effect sensor, and the microcontroller will attempt to read the output of the multiplexer.
			This will also be tested with two cascading multiplexers, as this might be necessary for the project. The output of the line could also be read with a voltmeter; the pins of the microcontroller in input mode are high impedence, so there wouldn't be too much of a difference.
			A lot of characterization could be done to determine an ideal magnet strength, but this initial testing is just to determine the viability of the selected multiplexer setup.

			<br><br>

			Since not much could be accomplished with hardware beyond what was shown in the above video, most of the remaining time spent was dedicated to filling out the Bill of Materials and compiling a set of references to use once the hardware arrives.
			I filled out the Microcontroller and OLED screen parts of the bill of materials, among a few other miscellaneous entries.
			I also went through and found datasheets and reference guides for the majority of our active components, putting them in the references portion of the website. This will help speed up the development process once the hardware does arrive, and having them all in one place will help when combining subsystems.
			
			<br>

			<h4>Week 5:</h4>
            <b>Date:</b> 25 September 2020<br>
            <b>Total hours:</b> 5<br>
			<b>Description of design efforts:</b><br>
			After receiving the OLED screen, effort was taken to get it up and running. The ultimate goal is to have something appear on the screen for SMAT next week. Below is a photo of the wiring for conventional SPI communication using the STM32F4's SPI1 pin package 1 configuration.

			<br>

			<p><img src="Team/progress/img/oled_initial_wiring.jpg" width="400" height="auto"></img></p>

			<br><br>

			As seen in the picture, a logic level shifter had to be used to convert from the 3V power of the display to the 5V commands and data sent from the board. The shifter chip was obtained with the Adafruit pack, but wiring had to be adapted for the F4 pins.

			<br><br>

			The pictured wiring is not enough to run the OLED. After investigating the driver chip, it implements two additional pins: DC, and RST. The DC pin is used to differentiate between data and commands. The use of the RST pin can be inferred, although past SPI devices seemed to use the NSS pin to achieve the same purpose.

			<br><br>

			Adafruit provides software for interfacing with the SSD1325 driver chip with an Arduino. Fortunately, the file is only about 300 lines long and makes use of many repeated functions which can be reimplemented on the STM32F4 family. Their overall grahpics driver module may be more tiresome to implement, so the current plan is to go with the uGUI module, which has STM32F4-friendly code included. For SMAT, just the chip driver should be sufficient; blinking regions of the screen will be done before showing graphics on it.
			The task of rewriting the oled driver file will be the primary focus of next week.

			<br><br>

			One task for this weekend is meeting with the physically local members of the team to send a package to our remote fourth member. He is working on the phone app currently, but testing the bluetooth connection will be important for this team member, so the extra parts I ordered last week are being diverted to this cause.
			This probably warrants the ordering of more backup parts now, but I am reluctant to do so myself after spending the most this week, so this will be brought up with the team when putting the package together.

			<br><br>

			My toolset for working with hardware from home is limited, but seems to be the most extensive of those physically present at Purdue. My multimeter is currently lent out to help with figuring out Hall effect sensors, and my soldering station could prove useful when working with sourced parts. The OLED screen comes in some configurations which require resoldering two resistors to set up for SPI communication. 
			Future orders of the screen without Adafruit's expensive full package may require the soldering station, even though we are not building a PCB. I wanted to document that fact about the oled screen here, in case it becomes important later in the semester.

			<br>

			<h4>Week 6:</h4>
            <b>Date:</b> 2 October 2020<br>
            <b>Total hours:</b> 6<br>
			<b>Description of design efforts:</b><br>

			The first undertaking of the week was to draw the schematic for the OLED screen subsystem. This was fairly easy, because the physical wiring was already done.
			However, two custom parts files had to be made, since the oled driver was pretty nonstandard. An exact match for the logic-level shifter was not found, so a library component was designed for that as well, with easy-to-read naming conventions specific to this project.

			<br><br>

			After combining the screen schematic with the other schematic work done by Dan, all of the "official" work was done for the week. The remainder of the time was spent writing and debugging the SPI interface with the OLED display.

			<br><br>

			<p><img src="Team/progress/img/progress_report_4.jpg" width="400" height="auto"></img></p>

			<br><br>

			As can be seen in the above photo, a workable demo of the display has not yet happened. However, significant progress in writing and fixing the software libraries has been made, and certain properties of the functionality have been verified through debugging.
			
			<br><br>

			The libraries I started with included a driver for interacting with a driver chip with an Arduino, and an SPI library for the STM32F4. Each one had to be rewritten, because we are using "Hardware Abstraction Layer" files instead of STDPeriph, and are not using an Arduino.
			Rewriting the SPI library typically consisted of just renaming defined constants to use different spelling or capitalization. That said, there were some missing functions which had to be rewritten, so not all 
			of the replacement was easy or fast. The specific interaction with the driver chip was written for Arduino, but mostly consisted of SPI commands and data sent which works with our chip without any special changes. Really just a handful of functions had 
			to be rewritten for this one.

			<br><br>

			As expected, there were several bugs in the files that I rewrote. The easy ones were found, and the configuration of the registers looks right. Unfortunately, one of the roommates of two in-person team members, including myself, tested positive
			for coronavirus this week, so it will not be possible to schedule an in-person lab session to debug the SPI signals. The tool I have now, a multimeter, is about as good as I will get for a while. I have verified that all of the static signals (like chip select, reset, and command/data) work as expected, but the
			clock and data signals will be very difficult to verify. The current approach uses hardware SPI, so a temporary way around this would be to use software SPI until more knowledge of how the chip works is known. I am really hoping to have a working demo
			for next week's show me a thing, so the software SPI approach should be taken this weekend to speed up debugging.

			<h4>Week 7:</h4>
            <b>Date:</b> 9 October 2020<br>
            <b>Total hours:</b> 10<br>
			<b>Description of design efforts:</b><br>

			The first class activities of the week were a continuation of the work from last week. I spent the weekend getting the OLED screen to work. This was done using software SPI, which was a valuable tool in debugging why the screen wasn't working. I was
			able to verify that the signals were appearing as expected, but noticed that, while the signals from the breadboard were coming through, the signals on the OLED PCB itself were either weak or not present. This was because I had failed to solder the
			throughhole pins onto the board. Fortunately, I had a soldering station on hand in my place of residence, so I got it set up in the kitchen for a quick soldering session.

			<br><br>

			<p><img src="Team/progress/img/oled_solder.jpg" width="400" height="auto"></img></p>

			<br><br>

			Without any changes to the software, the board now displayed correctly and flipped all of the pixels every few seconds (via a special SPI command for the chip), as I had intended for the demonstration. Included below is the SMAT video displaying this functionality.

			<br><br>

			<video width="320" controls>
				<source src="Media/img/SMAT_10_7.mp4" type="video/mp4">
				Your browser does not support the video tag.
			</video>

			<br><br>

			The progress on the screen was reassuring, but the week quickly became very busy and no more progress was made on this front. The screen will be reapproached after the Midterm Design Review.

			<br><br>

			The next major work was done on Tuesday, trying to figure out PCB design. I am not the primary PCB designer, but wanted to be on the call helping out Dan with figuring things out. I was able to get the parts of my subsystem working by finding correct
			library files for the footprints. The OLED screen footprint was more difficult since it had to be made by hand. The spacings of its pins are now correct on the schematic, but there still may be mechanical issues with making sure that the screen
			physically fits correctly on the board. More time will be spent ironing this out on the weekend.

			<br><br>

			For Thursday and Friday, most of my time was spent working on the Software Formalization Document. Our project is very software heavy, so it was difficult to go into the right amount of detail for each part of the project, especially when each module
			is being worked on by a different person. The sheer size of the Software Component Diagram was such that it had to be placed on the page horizontally. I did my best at describing the parts of the project that I knew about, and asked the team to look over
			the parts which they are responsible for. Emphasis was also placed on the parts of the project which are relevant to the PSSCs, which are the three on-chip modules: Graphics, Piece Detection and Bluetooth Interfaace. The components such as the Smartphone App and AWS Server
			are less relevant to course standards and less complicated overall, so they were given less detail.




			


        </div>
	
		<!-- Instantiate global footer. Any changes to the footer should be made through the top-level file "footer.html" -->
		<div id="footer"></div>
    </div>
</div>

<!--JS-->
<script src="js/jquery.js"></script>
<script src="js/jquery-migrate-1.1.1.js"></script>

<script type="text/javascript">
$(document).ready(function() {
    $("#header").load("header.html");
	$("#menu").load("navbar.html");
	$("#footer").load("footer.html");
});
</script>
</body>
</html>
